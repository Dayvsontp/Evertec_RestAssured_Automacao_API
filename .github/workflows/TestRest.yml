name: ExecuÃ§Ã£o de Testes com Tesults

on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]
  workflow_dispatch:

jobs:
  test_and_upload:
    runs-on: ubuntu-latest
    
    # ğŸš¨ REQUISITO DE SEGURANÃ‡A: Define as permissÃµes para o token GH_TOKEN
    permissions:
      contents: read # PermissÃ£o de leitura do cÃ³digo

    steps:
    - uses: actions/checkout@v4 # 1. Faz o checkout do cÃ³digo

    # 2. Configura a versÃ£o do Java (Use a versÃ£o do seu pom.xml, ex: 17 ou 21)
    - name: Set up JDK 21
      uses: actions/setup-java@v4
      with:
        java-version: '21' 
        distribution: 'temurin'
        cache: 'maven' # Cache de dependÃªncias

    # 3. Executar Testes e Enviar para Tesults
    - name: Rodar Testes e Fazer Upload para Tesults
      run: mvn clean test -DtesultsTarget=${{ secrets.TESULTS_TOKEN }}
      
      # ExplicaÃ§Ã£o:
      # -DtesultsTarget: Sobrescreve a propriedade <tesultsTarget> no seu pom.xml.
      # ${{ secrets.TESULTS_TOKEN }}: Puxa o token seguro que vocÃª deve configurar no GitHub.
